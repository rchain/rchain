# -*- coding: utf-8; mode: dockerfile -*-
#
# Copyright Â© 2018 RChain Cooperative
# Author: Chris Kirkwood-Watts <kirkwood@pyrofex.net>
#
# This file is licensed under the Apache License, version 2.0.

FROM ubuntu:16.04

RUN dpkg --add-architecture i386
RUN apt-get update && apt-get install -y openjdk-8-jre-headless libstdc++6:i386

ENV ESS_SYSDIR /usr/local/lib/rosette
ENV ROSETTE_LIB /usr/local/lib/rosette

ENV RHOLANG_JAR /usr/local/lib/rholang-assembly-0.1-SNAPSHOT.jar
COPY rholang/target/scala-2.12/rholang-assembly-0.1-SNAPSHOT.jar /usr/local/lib

COPY rosette/rbl/rosette /usr/local/lib/rosette
COPY rosette/build.out/src/rosette /usr/local/bin/rosette

COPY docker/rholang-cli/run-rhoscala /usr/local/bin

ENV RHOLANGWEB_VM_PROGRAM /usr/local/bin/rosette
ENV RHOLANGWEB_VM_LIBRARY /usr/local/lib/rosette

RUN apt-get install -y python3-pip && pip3 install --upgrade pip
ENV RHOLANGWEB_COMPILER_JAR /usr/local/lib/rholang-assembly-0.1-SNAPSHOT.jar

COPY rholang/examples /opt/rholang/lib/examples
ENV RHOLANGWEB_EXAMPLES_DIR /opt/rholang/lib/examples

COPY rholangweb /opt/rholangweb
WORKDIR /opt/rholangweb
RUN pip3 install -r requirements.txt
RUN python3 manage.py migrate

COPY docker/rholang-web/run-server .

ENTRYPOINT [ "/opt/rholangweb/run-server" ]

# Local Variables:
# indent-tabs-mode: nil
# fill-column: 79
# comment-column: 37
# End:
